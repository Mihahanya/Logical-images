<!DOCTYPE html>
<html>
<head>
	<title>Build an image according to a logical rule</title>
	<meta charset="utf-8">
	
	<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
	<script src="build.js" type="text/javascript"></script>
</head>

<body>
	<p style="margin: 18px 10px; font-family: monospace;">
		The variable is a single latin varter, <br>
		takes the value 0 or 1. <br><br>

		The binary functions: <br>
		~, ¬ negation <br>
		*, ∧, & conjunction <br>
		+, ∨ disjunction <br>
		^, ⨁ exclusive disjunction <br>
		|, ↑ alternative denial <br>
		/, ↓ joint denial <br>
		->, → implication <br>
		<-, ← converse implication <br>
		=, ≡ biconditional <br>
		</p>

	<textarea id="expression" type="text" spellcheck="false" placeholder="insert your logical expression here">a^b</textarea>

	<main>
		<p id="w_names" class="vars_names">a</p>
		<p id="h_names" class="vars_names" style="margin: 12px -36px; transform: rotate(90deg);">b</p>

		<svg id="display" viewBox="0 0 21 21" width="100%" height="100%" style="border: 1px solid"> </svg>
	</main>

	<footer> <a href="https:/github.com/Mihahanya"> 2022 Mihahanya </a> </footer>
</body>

<script>
	function display(bin_img) {
		var pixel = (pos_x, pos_y, color) => `<rect x="${pos_x}" y="${pos_y}" fill="${color}" width="1" height="1" id="template"></rect>` 

		$('#display').attr("viewBox", `0 0 ${bin_img[0].length} ${bin_img.length}`)

		var res = ''
		for (var i=0; i<bin_img.length; i++) {
			for (var j=0; j<bin_img[0].length; j++) {
				if (bin_img[i][j] == 0) res += pixel(j, i, '#222')
				else res += pixel(j, i, '#fff')
			}	
		}

		$("#display").html(res);
	}

	function get_vars_vals_by_ind(num, vars_names) {
		// (4, 'abcd') => [{name: 'a', val: 0}, {name: 'b', val: 1}, {name: 'c', val: 0}, {name: 'd', val: 0}]
		// bin(4) = 0b0100

		if (vars_names == '') return []

		num = num.toString(2)
		num = '0'.repeat(vars_names.length-num.length) + num

		var vars = []
		for (const i in vars_names)
			vars.push({name: vars_names[i], val: num[i]})
		
		return vars
	}

	function unique(str) {
		return Array.from(new Set(str))
	}

	display([[0, 1], [1, 0]])

	$('#expression').on('keydown keyup change', function() {
		var only_vars = $(this).val().replaceAll(/\W|[0-1]/g, '')
		var vars_names = unique(only_vars).sort()
		
		var w_names = vars_names.filter((_, i) => i % 2 == 0)
		var h_names = vars_names.filter((_, i) => i % 2 == 1)

		$('#w_names').html(w_names); $('#h_names').html(h_names)

		var res = []
		for (var i=0; i<2**h_names.length; i++) {
			var h_vars = get_vars_vals_by_ind(i, h_names)
						
			var l = []
			for (var j=0; j<2**w_names.length; j++) {
				var vars = h_vars.concat(get_vars_vals_by_ind(j, w_names))

				var pix = calculate_logical_expression($('#expression').val(), vars)
				l.push(pix)

				if (pix == null) { res[0] = null; break }
			}
			res.push(l)
		}

		if (res[0] != null) {
			display(res)

			// Normal borders
			$("#expression").attr('style', '')
			$("#display").attr('style', 'border: 1px solid')
		}
		else {
			// Red borders
			$("#expression").attr('style', 'border: 1px solid #e91e63')
			$("#display").attr('style', 'border: 1px solid #e91e63;')
		}
	})

	//console.log(calculate_logical_expression('a + b * (b -> b) + a * (b * a ^ (~a^b+b) -> b)', [{name:'a', val:0}, {name:'b', val:1}]))
	//console.log(calculate_logical_expression('a+(~b^c)->c', [{name:'a', val: 1}, {name:'b', val:0}, {name:'c', val:1}]))

</script>

<style>
	body {
		background-color: whitesmoke;
	}

	textarea {
		position: absolute;
		transform: translate(-50%, 0);
		top: 25px;
		left: 50%;
		padding: 10px 12px;
		
		height: 20px;
		width: 50vmin; max-width: 50vmin; min-width: 50vmin;
		
		background-color: #00000000;
		border: 1px solid;
		box-shadow: 5px 5px 15px 0px #0000001f;

		text-align: left;
		font-size: .95rem;
		font-family: monospace;
	}
	textarea:focus-visible {
		outline: 0;
		border: 1px solid #3f51b5;
	}

	main {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
	}

	footer {
		position: absolute;
		bottom: 10px;
		left: 50%;
		transform: translate(-50%, -50%);
	}

	.vars_names {
		position: absolute;
		margin: -30px 0;
		font-family: monospace;
	}
</style>

</html>
